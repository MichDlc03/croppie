<!DOCTYPE html>
<html>
<head>
  <title>Editar imagen</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <style>
    /* Estilos adicionales para el modal */
    #myModal .modal-dialog {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    
    #myModal .modal-content {
      width: auto;
      height: auto;
      max-width: 90%;
      max-height: 90%;
      overflow: hidden;
    }
    
    #upload-demo {
      width: 100%;
      height: 300px;
    }
  </style>
</head>
<body>
  <div class="container-fluid d-flex m-5">
    <div class="mb-3">
      <label for="formFile" class="form-label">Seleccione la imagen</label>
      <input class="form-control" type="file" id="inputImagen">
    </div>
    <div class="p-4">
        <h4>Foto Recortada</h4>
        <div id="uploaded_image"></div>
      </div>
  </div>
 
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-body">
          <div id="upload-demo"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="cropImage">Recortar</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
 


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.0/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.js"></script>
  <script>
    $(document).ready(function() {
      var $uploadCrop = $('#upload-demo').croppie({
        enableExif: true,
        viewport: {
          width: 200,
          height: 200,
          type: 'square'
        },
        boundary: {
          width: 300,
          height: 300
        }
      });

      $('#inputImagen').on('change', function(e) {
        var file = e.target.files[0];
        var reader = new FileReader();

        reader.onload = function(e) {
          $uploadCrop.croppie('bind', {
            url: e.target.result
          });
          $('#myModal').modal('show');
        }

        reader.readAsDataURL(file);
      });

      $('#cropImage').on('click', function(e) {
        $uploadCrop.croppie('result', {
          type: 'canvas',
          size: 'viewport'
        }).then(function(response) {
          $.ajax({
            url: "guardar-img.php",
            type: "POST",
            data: {"image": response},
            success: function(data) {
              $('#uploaded_image').html(data);
            }
          });
          // Cerrar el modal
          $('#myModal').modal('hide');
        });
      });
    });
  </script>
</body>
</html>